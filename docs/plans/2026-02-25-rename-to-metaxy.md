# Rename Project to Metaxy — Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Rename the entire project from `vercel-rpc` to `metaxy` in a single atomic commit.

**Architecture:** Global find-and-replace across all project files: Cargo configs, Rust source, TypeScript, docs, CI, changelogs. Directory renames via `git mv`. Snapshot tests auto-updated via `INSTA_UPDATE=always`. Generated TS files regenerated by running the CLI.

**Tech Stack:** Rust (Cargo workspace), TypeScript/Svelte (demo site), GitHub Actions CI

---

### Task 1: Rename crate directories

**Files:**
- Rename: `crates/rpc` → `crates/metaxy`
- Rename: `crates/rpc-macro` → `crates/metaxy-macro`
- Rename: `crates/rpc-cli` → `crates/metaxy-cli`

**Step 1: Rename directories with git mv**

```bash
cd /Users/mikhailzakharov/RustroverProjects/svelte-rust
git mv crates/rpc crates/metaxy
git mv crates/rpc-macro crates/metaxy-macro
git mv crates/rpc-cli crates/metaxy-cli
```

**Step 2: Rename config file in demo**

```bash
git mv demo/rpc.config.toml demo/metaxy.config.toml
```

---

### Task 2: Update workspace Cargo.toml

**Files:**
- Modify: `Cargo.toml` (root)

**Step 1: Update workspace members**

Change line 2:
```toml
# Before:
members = ["crates/rpc", "crates/rpc-macro", "crates/rpc-cli", "demo"]
# After:
members = ["crates/metaxy", "crates/metaxy-macro", "crates/metaxy-cli", "demo"]
```

---

### Task 3: Update crate Cargo.toml files

**Files:**
- Modify: `crates/metaxy/Cargo.toml`
- Modify: `crates/metaxy-macro/Cargo.toml`
- Modify: `crates/metaxy-cli/Cargo.toml`
- Modify: `demo/Cargo.toml`

**Step 1: Update `crates/metaxy/Cargo.toml`**

```toml
[package]
name = "metaxy"
version = "0.1.3"
edition = "2024"
description = "End-to-end typesafe RPC between Rust and TypeScript"
license = "MIT OR Apache-2.0"
repository = "https://github.com/misha-mad/metaxy"
homepage = "https://github.com/misha-mad/metaxy"
keywords = ["rpc", "metaxy", "serverless", "typescript", "codegen"]
categories = ["web-programming"]
readme = "README.md"

[lints]
workspace = true

[dependencies]
metaxy-macro = { path = "../metaxy-macro", version = "0.1" }
vercel_runtime = "2"
serde = { version = "1", features = ["derive"] }
serde_json = "1"
tokio = { version = "1", features = ["rt", "time"] }
url = "2"
http-body-util = "0.1"
http = "1"
```

**Step 2: Update `crates/metaxy-macro/Cargo.toml`**

```toml
[package]
name = "metaxy-macro"
version = "0.1.8"
edition = "2024"
description = "Procedural macros for Metaxy RPC framework"
license = "MIT OR Apache-2.0"
repository = "https://github.com/misha-mad/metaxy"
homepage = "https://github.com/misha-mad/metaxy"
keywords = ["rpc", "metaxy", "macro", "serverless", "typescript"]
categories = ["web-programming", "development-tools::procedural-macro-helpers"]
readme = "README.md"

[lints]
workspace = true

[lib]
proc-macro = true

[dependencies]
proc-macro2 = "1"
quote = "1"
syn = { version = "2", features = ["full"] }
```

**Step 3: Update `crates/metaxy-cli/Cargo.toml`**

Change these lines:
- Line 2: `name = "vercel-rpc-cli"` → `name = "metaxy-cli"`
- Line 5: `description = "CLI tool for Vercel RPC: parses Rust lambdas and generates TypeScript types and client"` → `description = "CLI tool for Metaxy: parses Rust functions and generates TypeScript types and client"`
- Line 7: `repository = "https://github.com/misha-mad/vercel-rpc"` → `repository = "https://github.com/misha-mad/metaxy"`
- Line 8: `homepage = "https://github.com/misha-mad/vercel-rpc"` → `homepage = "https://github.com/misha-mad/metaxy"`
- Line 9: `keywords = ["rpc", "vercel", "cli", "serverless", "typescript"]` → `keywords = ["rpc", "metaxy", "cli", "serverless", "typescript"]`
- Line 17: `name = "vercel_rpc_cli"` → `name = "metaxy_cli"`
- Line 21: `name = "rpc"` → `name = "metaxy"`

**Step 4: Update `demo/Cargo.toml`**

- Line 2: `name = "vercel-rpc-demo"` → `name = "metaxy-demo"`
- Line 8: `vercel-rpc = { path = "../crates/rpc" }` → `metaxy = { path = "../crates/metaxy" }`

---

### Task 4: Update Rust source — metaxy crate (facade)

**Files:**
- Modify: `crates/metaxy/src/lib.rs`

**Step 1: Replace all references**

Global replacements in this file:
- `vercel-rpc-macro` → `metaxy-macro`
- `vercel-rpc` → `metaxy`
- `vercel_rpc_macro` → `metaxy_macro`
- `vercel_rpc` → `metaxy`
- `use metaxy::rpc_query;` (in doc examples) stays the same after rename

---

### Task 5: Update Rust source — metaxy-macro crate

**Files:**
- Modify: `crates/metaxy-macro/src/lib.rs`

**Step 1: Replace all references**

Global replacements in this file:
- `vercel-rpc-cli` → `metaxy-cli`
- `vercel-rpc-macro` → `metaxy-macro`
- `vercel-rpc` → `metaxy`
- `vercel_rpc_macro` → `metaxy_macro`
- `vercel_rpc` → `metaxy`
- `Vercel` → `Metaxy` (in description contexts like "Vercel RPC framework", "Vercel serverless lambda handlers")
- `github.com/misha-mad/vercel-rpc` → `github.com/misha-mad/metaxy`
- `crates.io/crates/vercel-rpc-cli` → `crates.io/crates/metaxy-cli`
- `crates.io/crates/vercel-rpc` → `crates.io/crates/metaxy`

---

### Task 6: Update Rust source — metaxy-cli crate

**Files:**
- Modify: `crates/metaxy-cli/src/lib.rs`
- Modify: `crates/metaxy-cli/src/main.rs`
- Modify: `crates/metaxy-cli/src/config.rs`
- Modify: `crates/metaxy-cli/src/codegen/common.rs`

**Step 1: Update `src/lib.rs`**

- Line 1: `//! CLI tool for the [vercel-rpc](https://github.com/misha-mad/vercel-rpc) project.` → `//! CLI tool for the [metaxy](https://github.com/misha-mad/metaxy) project.`

**Step 2: Update `src/main.rs`**

- Line 6: `use vercel_rpc_cli::config::FieldNaming;` → `use metaxy_cli::config::FieldNaming;`
- Line 7: `use vercel_rpc_cli::{commands, config, watch};` → `use metaxy_cli::{commands, config, watch};`
- Line 11: `name = "rpc",` → `name = "metaxy",`
- Line 12: `about = "Vercel RPC CLI — parse Rust lambdas and generate TypeScript bindings"` → `about = "Metaxy CLI — parse Rust functions and generate TypeScript bindings"`
- Line 15: `/// Path to the config file (default: auto-discover rpc.config.toml)` → `/// Path to the config file (default: auto-discover metaxy.config.toml)`

**Step 3: Update `src/config.rs`**

- Line 7: `pub const CONFIG_FILE_NAME: &str = "rpc.config.toml";` → `pub const CONFIG_FILE_NAME: &str = "metaxy.config.toml";`
- Line 128: `/// Walk up from `start` looking for `rpc.config.toml`.` → `/// Walk up from `start` looking for `metaxy.config.toml`.`

**Step 4: Update `src/codegen/common.rs`**

- Lines 11-13: Change the GENERATED_HEADER:
```rust
pub const GENERATED_HEADER: &str = "\
// This file is auto-generated by metaxy-cli. Do not edit manually.
// Re-run `metaxy generate` or use `metaxy watch` to regenerate.
";
```

**Step 5: Search and replace in remaining codegen files**

Search all files in `crates/metaxy-cli/src/` for any remaining `vercel` or `rpc` references that need updating. The codegen modules (types.rs, client.rs, svelte.rs, react.rs, vue.rs, solid.rs) likely don't contain direct crate name references beyond what's in common.rs.

---

### Task 7: Update demo Rust files

**Files:**
- Modify: all `demo/api/*.rs` files

**Step 1: Replace imports in all demo API files**

In every file in `demo/api/`:
- `use vercel_rpc::` → `use metaxy::`

---

### Task 8: Update demo TypeScript/config files

**Files:**
- Modify: `demo/package.json`
- Modify: `demo/metaxy.config.toml` (already renamed in Task 1)

**Step 1: Update `demo/package.json`**

- `"name": "vercel-rpc-demo"` → `"name": "metaxy-demo"`
- `vercel-rpc-cli` → `metaxy-cli` (in all script commands)
- `vercel-rpc.vercel.app` → `metaxy.vercel.app` (in e2e test URL)

**Step 2: Update `demo/metaxy.config.toml` header comment**

- `# rpc.config.toml` → `# metaxy.config.toml`

---

### Task 9: Update test files and regenerate snapshots

**Files:**
- Modify: all `crates/metaxy-cli/tests/*.rs`
- Auto-update: all `crates/metaxy-cli/tests/snapshots/*.snap`

**Step 1: Replace references in test source files**

Search and replace in all `.rs` files in `tests/`:
- `vercel_rpc_cli` → `metaxy_cli`
- `vercel-rpc-cli` → `metaxy-cli`
- `vercel-rpc` → `metaxy`
- `rpc.config.toml` → `metaxy.config.toml`

**Step 2: Regenerate snapshot files**

```bash
cd /Users/mikhailzakharov/RustroverProjects/svelte-rust
INSTA_UPDATE=always cargo test -p metaxy-cli
```

This will auto-update all `.snap` files with the new header text (`metaxy-cli` instead of `vercel-rpc-cli`).

---

### Task 10: Update documentation files

**Files:**
- Modify: `README.md`
- Modify: `CONTRIBUTING.md`
- Modify: `crates/metaxy/README.md`
- Modify: `crates/metaxy-cli/README.md`
- Modify: `crates/metaxy-macro/README.md`
- Modify: `docs/PROJECT-STRUCTURE.md`
- Modify: `docs/ROADMAP.md`
- Modify: all `docs/RFC/*.md`

**Step 1: Global search-and-replace in all markdown files**

Replacements (in order — more specific first):
1. `vercel-rpc-cli` → `metaxy-cli`
2. `vercel-rpc-macro` → `metaxy-macro`
3. `vercel-rpc-demo` → `metaxy-demo`
4. `vercel-rpc` → `metaxy` (the crate)
5. `vercel_rpc_cli` → `metaxy_cli`
6. `vercel_rpc_macro` → `metaxy_macro`
7. `vercel_rpc` → `metaxy`
8. `github.com/misha-mad/vercel-rpc` → `github.com/misha-mad/metaxy`
9. `vercel-rpc.vercel.app` → `metaxy.vercel.app`
10. `rpc.config.toml` → `metaxy.config.toml`

Also update descriptions that mention "Vercel" specifically in the context of the product name:
- "Vercel RPC" → "Metaxy"
- Keep generic "Vercel" references where they refer to the deployment platform

---

### Task 11: Update demo site pages

**Files:**
- Modify: all `demo/src/routes/**/*.svelte` files (30 files)
- Modify: all `demo/src/routes/**/*.ts` files
- Modify: `demo/src/routes/Header.svelte`
- Modify: `demo/src/routes/+layout.svelte`

**Step 1: Global search-and-replace in demo/src/**

Same replacement set as Task 10. Key patterns:
- `vercel-rpc-cli` → `metaxy-cli`
- `vercel-rpc` → `metaxy`
- `vercel_rpc` → `metaxy`
- `cargo install vercel-rpc-cli` → `cargo install metaxy-cli`
- `cargo add vercel-rpc` → `cargo add metaxy`
- `cargo run -p vercel-rpc-cli` → `cargo run -p metaxy-cli`
- `rpc.config.toml` → `metaxy.config.toml`
- `rpc generate` → `metaxy generate` (CLI command references)
- `rpc watch` → `metaxy watch`
- `rpc scan` → `metaxy scan`

---

### Task 12: Regenerate TypeScript files

**Files:**
- Auto-update: `demo/src/lib/rpc-client.ts`
- Auto-update: `demo/src/lib/rpc-types.ts`
- Auto-update: `demo/src/lib/rpc.svelte.ts`

**Step 1: Run the CLI to regenerate**

```bash
cd /Users/mikhailzakharov/RustroverProjects/svelte-rust/demo
cargo run --manifest-path ../Cargo.toml -p metaxy-cli -- generate
```

This will regenerate all three TS files with the updated `metaxy-cli` header.

---

### Task 13: Update CI/CD and GitHub config

**Files:**
- Modify: `.github/workflows/coverage.yml`
- Modify: `.github/workflows/ci.yml` (if references exist)
- Modify: `.github/workflows/release-plz.yml` (if references exist)
- Modify: `.github/DISCUSSION_TEMPLATE/*.yml`
- Modify: `.github/ISSUE_TEMPLATE/*.yml`

**Step 1: Update coverage.yml**

Replace `vercel-rpc-macro` → `metaxy-macro`, `vercel-rpc-demo` → `metaxy-demo`, and update any paths referencing `crates/rpc-cli/` → `crates/metaxy-cli/`.

**Step 2: Update all GitHub templates**

Search and replace `vercel-rpc` → `metaxy` in all `.yml` files under `.github/`.

---

### Task 14: Update project config files

**Files:**
- Modify: `CLAUDE.md`
- Modify: `release-plz.toml`

**Step 1: Update `CLAUDE.md`**

- Line 6: `Scopes: rpc, rpc-macro, rpc-cli` → `Scopes: metaxy, metaxy-macro, metaxy-cli`

**Step 2: Update `release-plz.toml`**

- Line 8: `name = "vercel-rpc-demo"` → `name = "metaxy-demo"`

---

### Task 15: Update CHANGELOG files

**Files:**
- Modify: `crates/metaxy/CHANGELOG.md`
- Modify: `crates/metaxy-cli/CHANGELOG.md`
- Modify: `crates/metaxy-macro/CHANGELOG.md`

**Step 1: Replace URLs and crate names**

Same replacement set as Task 10, applied to all three CHANGELOG files.

---

### Task 16: Regenerate Cargo.lock and verify build

**Step 1: Delete old Cargo.lock and regenerate**

```bash
cd /Users/mikhailzakharov/RustroverProjects/svelte-rust
rm Cargo.lock
cargo generate-lockfile
```

**Step 2: Build the project**

```bash
cargo build --workspace
```

Expected: successful build with no errors.

**Step 3: Run all tests**

```bash
cargo test --workspace
```

Expected: all tests pass.

**Step 4: Run clippy**

```bash
cargo clippy --workspace -- -D warnings
```

Expected: no warnings.

---

### Task 17: Commit all changes

**Step 1: Stage and commit**

```bash
git add -A
git commit -m "feat!: rename project from vercel-rpc to metaxy

BREAKING CHANGE: all crate names changed:
- vercel-rpc → metaxy
- vercel-rpc-macro → metaxy-macro
- vercel-rpc-cli → metaxy-cli
- vercel-rpc-demo → metaxy-demo

Binary renamed from 'rpc' to 'metaxy'.
Config file renamed from 'rpc.config.toml' to 'metaxy.config.toml'.
Repository URL updated to github.com/misha-mad/metaxy."
```

---

### Task 18: Rename root directory

**Step 1: Rename project directory**

```bash
mv /Users/mikhailzakharov/RustroverProjects/svelte-rust /Users/mikhailzakharov/RustroverProjects/metaxy
```

**Step 2: Verify project still works from new location**

```bash
cd /Users/mikhailzakharov/RustroverProjects/metaxy
cargo build --workspace
cargo test --workspace
```
